# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
    - '*'
    # - master
    # - releases/*
  paths:
    exclude:
    - README.md
    - CHANGELOG.md

jobs:
  - job: Windows
    pool:
      vmImage: 'windows-latest'

    steps:
    # - powershell: 'Install-Module -Name Pester -Force -SkipPublisherCheck'
    # - powershell: 'Install-Module -Name Pester -Force -SkipPublisherCheck -MaximumVersion 4.99.99'
    - powershell: 'Install-Module -Name Pester -Force -SkipPublisherCheck -RequiredVersion 4.10.1'    
      displayName: 'Update Pester'
    - powershell: 'Install-Module -Name ImportExcel -Force -SkipPublisherCheck'
      displayName: 'Install ImportExcel'
    - powershell : 'Invoke-Pester'
      displayName: 'Run tests'
    # - powershell: './CI/CI.ps1 -Test'
    #   displayName: 'Install and Test'

  # - job: WindowsPSCore
  #   pool:
  #     vmImage: 'windows-latest'

  #   steps:
  #   - pwsh: 'Install-Module -Name Pester -Force'
  #     displayName: 'Update Pester'
  #   - pwsh: 'Install-Module -Name ImportExcel -Force -SkipPublisherCheck'
  #     displayName: 'Install ImportExcel'
  #   - pwsh: './CI/CI.ps1 -Test'
  #     displayName: 'Install and Test'

  # - job: Ubuntu
  #   pool:
  #     vmImage: 'ubuntu-latest'

  #   steps:
  #   - powershell: 'Install-Module -Name Pester -Force'
  #     displayName: 'Update Pester'
  #   - powershell: 'Install-Module -Name ImportExcel -Force -SkipPublisherCheck'
  #     displayName: 'Install ImportExcel'
  #   - powershell: './CI/CI.ps1 -Test'
  #     displayName: 'Install and Test'

  # - job: macOS
  #   pool:
  #     vmImage: 'macOS-latest'

  #   steps:
  #   - script: brew install mono-libgdiplus
  #     displayName: 'Install mono-libgdiplus'
  #   - powershell: 'Install-Module -Name Pester -Force'
  #     displayName: 'Update Pester'
  #   - powershell: 'Install-Module -Name ImportExcel -Force -SkipPublisherCheck'
  #     displayName: 'Install ImportExcel'
  #   - powershell: './CI/CI.ps1 -Test'
  #     displayName: 'Install and Test'